<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Environmental Justic Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="top-bar">
  <h1>Environmental Justice Dashboard</h1>
    <button id="aboutBtn">About</button>
  </header>
  <div id="main">
    <aside id="sidePanel">
      <details id="dataStep" open>
        <summary>Step 1: Load or Search Data</summary>
        <ul>
          <li data-url="hazardous_sites_small.csv">Hazardous Waste Sites</li>
          <li data-url="superfund_sites.csv">Superfund Sites</li>
        </ul>
        <input type="file" id="fileInput" accept=".csv,.geojson">
        <div><a href="template.csv" download>Download template CSV</a></div>
        <div id="search-container">
          <input type="text" id="search-input" placeholder="Enter address, city, or zip...">
          <button id="search-btn">Search</button>
        </div>
      </details>
      <details id="selectionStep" open>
        <summary>Step 2: Select Markers</summary>
        <div id="selectionCount">Selected Points: 0</div>
        <button id="clearSelectionBtn">Clear Selection</button>
      </details>
      <details id="distanceStep" open>
        <summary>Step 3: Set Buffer Distances</summary>
        <label for="proximalSlider">Proximal (miles)</label>
        <input type="range" id="proximalSlider" min="0" max="20" value="0" step="0.25">
        <span id="proximalValue">0.00</span>
        <label for="distalSlider">Distal (miles)</label>
        <input type="range" id="distalSlider" min="0" max="100" value="0" step="0.25">
        <span id="distalValue">0.00</span>
      </details>
      <details id="demographicsStep" open>
        <summary>Step 4: Variables & Census Options</summary>
        <label for="demographicSelect">Data Marker:</label>
        <select id="demographicSelect">
          <!-- Default: Median Household Income -->
          <option value="B19013_001E" data-label="Median Household Income" data-type="median" data-variables="B19013_001E" selected>Median Household Income</option>
          <!-- Second: Educational Attainment -->
          <option value="B15003_022E,B15003_023E,B15003_024E,B15003_025E" data-label="Bachelor's Degree or Higher" data-total="B15003_001E" data-type="rate" data-variables="B15003_022E,B15003_023E,B15003_024E,B15003_025E">Bachelor's Degree or Higher</option>
          <!-- Then race variables -->
          <option value="B03002_003E" data-label="Non-Hispanic White" data-total="B03002_001E" data-type="rate" data-variables="B03002_003E">Non-Hispanic White</option>
          <option value="B03002_004E" data-label="Non-Hispanic Black" data-total="B03002_001E" data-type="rate" data-variables="B03002_004E">Non-Hispanic Black</option>
          <option value="B03002_006E" data-label="Asian" data-total="B03002_001E" data-type="rate" data-variables="B03002_006E">Asian</option>
          <option value="B03002_005E" data-label="Native American" data-total="B03002_001E" data-type="rate" data-variables="B03002_005E">Native American</option>
          <option value="B03002_012E" data-label="Hispanic or Latino" data-total="B03002_001E" data-type="rate" data-variables="B03002_012E">Hispanic or Latino</option>
          <option value="B03002_007E,B03002_008E,B03002_009E" data-label="Other (Non-Hispanic)" data-total="B03002_001E" data-type="rate" data-variables="B03002_007E,B03002_008E,B03002_009E">Other (Non-Hispanic)</option>
        </select>
        <div style="margin-top:8px">
          <label for="acsYearSelect">ACS Year:</label>
          <select id="acsYearSelect">
            <option value="2023" selected>2023</option>
            <option value="2022">2022</option>
            <option value="2021">2021</option>
            <option value="2020">2020</option>
            <option value="2019">2019</option>
          </select>
        </div>
        <div style="margin-top:8px">
          <label for="geographySelect">Geography:</label>
          <select id="geographySelect">
            <option value="bg">Block Group</option>
            <option value="tract" selected>Tract</option>
          </select>
        </div>
      </details>
      <details id="analyzeStep" open>
        <summary>Step 5: Analyze & Export</summary>
        <button id="analyzeBtn">Analyze</button>
        <div id="chartContainer"><canvas id="demographicChart"></canvas></div>
        <div id="chartMeta" class="chart-meta"></div>
        <div id="chartActions" class="chart-actions">
          <button id="chartPopoutBtn" disabled>Open Report</button>
          <button id="downloadPngBtn" disabled>Download PNG</button>
          <button id="downloadCsvBtn" disabled>Download CSV</button>
        </div>
        <div id="resultsTable" class="results-table"></div>
      </details>
    </aside>
    <div id="map"></div>
    <div id="north-arrow">
      <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <polygon points="24,4 30,24 24,20 18,24" fill="#fff" stroke="#333" stroke-width="2"/>
        <text x="24" y="40" text-anchor="middle" fill="#fff" font-size="16" font-family="Arial" font-weight="bold">N</text>
      </svg>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="app.js"></script>
</body>
</html>
